{% load express_tags %}

{% with table_name=supply_zinc_table_id %}
    <form action="/common/change_table" method="post" autocomplete="off" oninput="on_form_change(this)">
        <input hidden name="table_name" value="{{ table_name }}">
        <input hidden name="journal_page" value="{{ journal_page }}">

        {% with table_data=full_data|table_keyval:table_name %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th> Конц. смт </th>
                    <th> Zn </th>
                </tr>
            </thead>
            <tbody>
            {% if table_data.concentrate|length == 0 %}
                <tr class="indexed-line">
                        <input class="index-input" hidden name="index" value=0>
                        <td>{% include "value.html" with field_name="concentrate" index=0 %}</td>
                        <td>{% include "value.html" with field_name="zn" index=0 %}</td>
                    </tr>
            {% else  %}
                {% for _ in table_data.concentrate %}
                    <tr class="indexed-line">
                        <input class="index-input" hidden name="index" value="{{ forloop.counter0 }}">
                        <td>{% include "value.html" with field_name="concentrate" index=forloop.counter0 %}</td>
                        <td>{% include "value.html" with field_name="zn" index=forloop.counter0 %}</td>
                    </tr>
                {%  endfor %}
            {%  endif %}
            </tbody>

        </table>
        {%  endwith %}
        <input type="button" class="btn btn-primary" id="sozc__btn-back" value="Назад">
        <input type="button" class="btn btn-success pull-right" id="sozc__btn-next" value="Далее">
    </form>
{% endwith %}

<script>

    function redirect(baseLink = '/', date, mode) {
        window.location.href = baseLink + "?month=" + date + "&mode=" + mode;
    }

    $(document).ready(()=>{
        $("#sozc__btn-back").on('click', () => {
           let date = $("#selected_month").val();
           let mode = $('input[name=mode]:checked').attr('id');
           let prev = (new Date(date)).decrementMonth();
           redirect('/furnace/shihta', prev.getMonthWithYear(), mode);
        });

        $("#sozc__btn-next").on('click', () => {
            let date = $("#selected_month").val();
           let mode = $('input[name=mode]:checked').attr('id');
           let next = (new Date(date)).incrementMonth();
           redirect('/furnace/shihta', next.getMonthWithYear(), mode);
        });
    })
</script>

