{% load express_tags %} {# Loading our tags #}

<!--
{% set_global_context "val" table_data|keyval:field_name|choose_val:index %} {# Setting val variable#}
{% set_global_context "info" fields_info|keyval:journal_name|keyval:table_name|keyval:field_name %}
{% set_global_context "field_comment_name" field_name|add:"_comment" %}
{% set_global_context "id" full_data|table_keyval:"id"|table_keyval:table_name|keyval:field_name|keyval:index %}
{% set_global_context "field_responsible_name" field_name|add:"_responsible" %}
{% set_global_context "responsible" table_data|keyval:field_responsible_name|choose_val:index %}
{% set_global_context "comment" table_data|keyval:field_comment_name|choose_val:index %}
{#{% set_global_context "cell_id" journal_page|add:"|"|add:table_name|add:"|"|add:field_name|add:"|"|add:index %}#}

{% if validate %}
    {% set_global_context "onclick" "onclick=\"showPopup(\'{}\')\""|formatter:field_name %}
{% else %}
    {% set_global_context "onclick" "" %}
{% endif %}
-->

<input class="resp" hidden name="{{ field_responsible_name }}" value="{{ responsible }}">

    <input class="form-control general-value {{ field_name }}_{{ index }}"
           oninput="on_input_change(this);add_responsible(this, '{{ user.employee }}');$('#sync').hide();$('#async').show();"
           onchange="add_message(this);reformat_on_change(this)"
           title="{% if responsible %}{% if val %}Заполнил: {{ responsible }}{% endif %}{% endif %}"
           value="{% firstof auto_val val %}"
           data-info="{{ info }}"
           table-name="{{ table_name }}"
           journal-page="{{ journal_page }}"
           name="{{ field_name }}"
           index="{{ index }}"
    {#       id="{{ cell_id }}"#}       data-pagmode="{{ page_mode }}"
            {% if page_mode == 'view' or page_mode == 'validate' %}
           readonly="readonly"
            {% endif %}
            {% if page_mode == 'validate' %}
           onclick="showValidatePopup(this)"
            {% else %}
           onclick="this.select()"
            {%endif %}
    />

<!--
{{ field_comment_name }}
{{ table_data|keyval:field_comment_name }}
{{ comment }}
-->

<span class="popup-comment-content">
   <div class="comment-close-button"
        onclick="hidePopups()">&#10006;</div>
   <textarea name="{{ field_comment_name }}"
             placeholder="Комментарий..."
             rows="2"
             class="popup-comment-content-textarea"
             oninput="addCommentNotification(this);"
             onchange="add_comment(this);"
             table-name="{{ table_name }}"
             journal-page="{{ journal_page }}"
             index="{{ index }}"
             cols="50"
           {% if page_mode == 'view' %}
             readonly="readonly"
           {% endif %}
   >{{ comment }}</textarea>
</span>

{% if page_mode == "view"  or page_mode == "validate" %}
    <i class="material-icons comment-notification"
       onclick="showViewPopup(this)">mail</i>
{% endif %}
